<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* ðŸ”µ Blur aplicado solo a la galerÃ­a */
    #gallery {
      filter: blur(6px);
      pointer-events: none; /* que no se puedan clickear */
      user-select: none;    /* que no se puedan seleccionar */
    }
  </style>
</head>
<body class="bg-light">

  <div class="container py-5">
    <div class="card shadow-lg p-4 mb-4">
      <h1 class="h3 text-center mb-4 text-primary">Panel de AdministraciÃ³n</h1>

      <div class="d-flex justify-content-center gap-3 mb-4">
        <button id="startGame" class="btn btn-success">
          <i class="bi bi-play-circle"></i> Iniciar Juego
        </button>
        <button id="nextPhoto" class="btn btn-warning" disabled>
          <i class="bi bi-skip-forward-circle"></i> Siguiente Foto
        </button>
      </div>

      <div id="game" class="text-center p-3 bg-white rounded shadow-sm"></div>
    </div>

    <div class="card shadow-lg p-4">
      <h2 class="h4 mb-4 text-secondary">ðŸ“¸ GalerÃ­a de Fotos</h2>
      <div id="gallery" class="row g-4"></div>
    </div>
  </div>

  <!-- Bootstrap JS + Icons -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<script>
const user = JSON.parse(localStorage.getItem('user'))
if (!user) location.href = '/'

const BASE_URL = window.location.origin

let fotos = []
let currentIndex = 0

// Iniciar juego
document.getElementById('startGame').onclick = async () => {
  const res = await fetch(`${BASE_URL}/api/photos`)
  fotos = await res.json()
  currentIndex = 0

  if (fotos.length > 0) {
    mostrarFoto(fotos[currentIndex])
    document.getElementById('nextPhoto').disabled = false
  } else {
    document.getElementById('game').innerHTML = 
      '<p class="text-danger">No hay fotos disponibles.</p>'
    document.getElementById('nextPhoto').disabled = true
  }
}

// Siguiente foto
document.getElementById('nextPhoto').onclick = () => {
  currentIndex++
  if (currentIndex < fotos.length) {
    mostrarFoto(fotos[currentIndex])
  } else {
    document.getElementById('game').innerHTML = 
      '<p class="fw-bold text-danger">No hay mÃ¡s fotos.</p>'
    document.getElementById('nextPhoto').disabled = true
  }
}

// Mostrar foto centrada
function mostrarFoto(foto) {
  const div = document.getElementById('game')
  div.innerHTML = `
    <img src="${BASE_URL}/uploads/${foto.filename}" 
         class="img-fluid rounded shadow-sm d-block mx-auto" 
         style="max-height:400px">
    <p class="mt-2 text-muted">Foto #${foto.id}</p>
  `
}

// Cargar galerÃ­a (todas abajo)
async function loadGallery() {
  const res = await fetch(`${BASE_URL}/api/photos`)
  const fotos = await res.json()
  const div = document.getElementById('gallery')
  div.innerHTML = ''

  if (!Array.isArray(fotos) || fotos.length === 0) {
    div.innerHTML = '<p class="text-muted text-center">No hay fotos subidas.</p>'
    return
  }

  fotos.forEach(f => {
    const col = document.createElement('div')
    col.className = 'col-6 col-md-4 col-lg-3'
    col.innerHTML = `
      <div class="card shadow-sm h-100">
        <img src="${BASE_URL}/uploads/${f.filename}" class="card-img-top" style="object-fit:cover; height:180px">
        <div class="card-body text-center">
          <button class="btn btn-danger btn-sm" onclick="deletePhoto(${f.id})">
            <i class="bi bi-trash"></i> Borrar
          </button>
        </div>
      </div>
    `
    div.appendChild(col)
  })
}

async function deletePhoto(id) {
  if (!confirm('Â¿Seguro que quieres borrar esta foto?')) return
  await fetch(`${BASE_URL}/api/photos/${id}`, { method: 'DELETE' })
  loadGallery()
}

loadGallery()
</script>
</body>
</html>
